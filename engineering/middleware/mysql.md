# mysql

## 慢SQL排查

1. 定位慢SQL

    a. 基于orm框架日志

    b. 基于数据库慢查询日志

2. explain慢SQL，查看执行计划

    a. type：表示查询时所使用的索引类型，关注ALL、index、range、ref、eq_ref，从左到右效率越高

    b. key：表示查询优化器选择使用的索引

    c. rows： 表示此操作需要扫描的行数，即扫描表中多少行才能得到结果

## SQL执行过程

1. 连接器：处理连接，权限校验等
2. 查询缓存：命中则直接返回缓存结果，否则继续执行
3. 解析器：词法分析和预发分析，产出解析树
4. 预处理器：语义检验，判断表/字段是否存在、用户时候有权限等，产出预处理后的解析树
5. 查询优化器：对SQL进行等价变换，选择最优的连接顺序、索引等，产出执行计划
6. 执行器：调用存储引擎的API来执行优化器生成的执行计划
5. 存储引擎：存储引擎负责真正的数据读写