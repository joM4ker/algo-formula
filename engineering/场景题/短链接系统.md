# 短链接系统

## 短链接生成算法

### 演进

1. 采用MD5或SHA这种哈希算法：可能出现哈希冲突
2. 结合哈希算法和自增键后缀：即链地址法，缓解哈希冲突，但是容易被穷举
3. 使用雪花算法：生成的字符串太长

### 主流做法

基于MurmurHash+62进制转换

1. MurmurHash：虽然hash空间比其他hash算法小，但是计算速度更快（非加密hash算法），且结果更均匀，适合短链接生成
2. 62进制转换：从base64的基础上去掉+和/，因为许多url不适应这种字符

## 映射存储

采用kv缓存服务存储，短链接作为key，长链接作为value

## 跳转实现

采用301或302重定向

301永久重定向会被浏览器缓存，下次访问直接跳转
302临时重定向每次都会经过服务器重启查询原始长链接

302更加灵活，可以利用重新查询做数据统计和拦截

## 短链接过期机制

1. Redis缓存过期时间设置
2. 数据库映射表增加过期时间字段

## 短链接唯一性

1. 数据库映射表中，对长链接字段加唯一索引
2. 同一个长链接生成短链接的时候加分布式锁

## 短链接防滥用

1. 原始链接对应恶意网站。生成短链接前采用风控引擎对原始链接进行扫描
2. 采用足够长度和随机性的短链接，避免被穷举
3. 短链接访问限制，基于IP+短链接字符串进行限流
4. 生成短链接绑定用户ID，溯源问题短链接，同时可以保护短链接生成接口